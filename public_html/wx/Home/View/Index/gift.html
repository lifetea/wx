<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>积分兑换|车侣威擎</title>
<meta content="telephone=no" name="format-detection" />
<style type="text/css">
/* 
html5doctor.com Reset Stylesheet
v1.4.1 
2010-03-01
Author: Richard Clark - http://richclarkdesign.com
*/

html, body, div, span, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
abbr, address, cite, code,
del, dfn, em, img, ins, kbd, q, samp,
small, strong, sub, sup, var,
b, i,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section, summary,
time, mark, audio, video {
    margin:0;
    padding:0;
    border:0;
    outline:0;
    font-size:98%;
    vertical-align:baseline;
    background:transparent;
}

body {
    line-height:1;
}

:focus {
    outline: 1;
}

article,aside,canvas,details,figcaption,figure,
footer,header,hgroup,menu,nav,section,summary { 
    display:block;
}

nav ul {
    list-style:none;
}

blockquote, q {
    quotes:none;
}

blockquote:before, blockquote:after,
q:before, q:after {
    content:'';
    content:none;
}

a {
    margin:0;
    padding:0;
    border:0;
    font-size:100%;
    vertical-align:baseline;
    background:transparent;
}

ins {
    background-color:#ff9;
    color:#000;
    text-decoration:none;
}

mark {
    background-color:#ff9;
    color:#000; 
    font-style:italic;
    font-weight:bold;
}

del {
    text-decoration: line-through;
}

abbr[title], dfn[title] {
    border-bottom:1px dotted #000;
    cursor:help;
}

table {
    border-collapse:collapse;
    border-spacing:0;
}

hr {
    display:block;
    height:1px;
    border:0;   
    border-top:1px solid #cccccc;
    margin:1em 0;
    padding:0;
}

input, select {
    vertical-align:middle;
}
.hide{display: none}
</style>

<style type="text/css">
    html,body,.main{
        background:#ffc446;
    }
    img {border:none;} 
    ul{list-style: none;}
    .left{float: left;}
    .right{float: right;}
    .list li{
        background: #ffc446;
        border-bottom: 1px solid #d1a13a;
    }
    .list .order{
        text-align: center;
        vertical-align: middle;
        #padding-top: 15%;
    }
    h3{
        font-family: "微软雅黑";
        text-align: center;
        font-weight: normal;
        font-size: 160%;
        line-height: 220%;     
    }
    .score p{
        font-family: "微软雅黑";
        text-align: center;
        line-height: 170%;           
    }
    .t1{
        font-size: 120%;
    }
    .score .count{
        font-size: 100%;
    }
    .score .credit{
        color: #ad1919;
        font-size: 100%;
    }
    .order span{
        font-family: "微软雅黑";
        font-size: 180%;
        text-align: center;
    }
    .avatar{
        float: left;
    }
    .pic{
        float: left;
    }
    .pic img{
        width: 100%;
        #border: 3px solid #e1baaa;
    }
    .header,.header img{width: 100%;}

    .sore{
        padding-left: 8%;
        #padding-top: 15%;
    }
    .pl10{
        padding-left: 10%;
    }
    .pr10{
        padding-right: 10%;
    }
    .sore span{
        font-family: "微软雅黑";
        font-size: 180%;
        color: #0daf70;
    }
    a{
        text-decoration:none;
    }
    .exchange .btn{
        #width: 120px;
        #height: 30px;
        #border-radius: 5px;
        #background: #ffc446;
        #border: 1px solid #fff;
        #color: #fff;
        #padding: 6px 18px 6px 18px;
    }
    .red {color:#d44950}
    .tab{display: block;width: 49.99%;float: left;text-align: center;vertical-align: middle;font-family: "微软雅黑";font-size: 26px;color:white;}
    .tab img{width: 100%}
    .menu{border-bottom: 1px solid #d1a13a;}
    .menu .first{border-right: 1px solid #d1a13a;}
    .bottom{border-bottom: 1px solid #d1a13a;}
    .menu a:visited{background: #e95704;text-decoration: none;}
    img.erwei{width: 100%;}
</style>
<link href="http://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="main">
        <div class="header">
            <img src="{$Think.config.SRC}/gift-h.jpg">
        </div>
        <div class="menu">
            <a class="tab bottom" href="http://wx.vlegend.cn/ji?self=1">
                <img src="http://wx.vlegend.cn/Public/tab-1.png">
            </a>
            <a class="tab bottom" href="http://wx.vlegend.cn/cj.html">
                <img src="http://wx.vlegend.cn/Public/tab-2.png">
            </a>
            <a class="tab" href="http://wx.vlegend.cn/bird.html">
                <img src="http://wx.vlegend.cn/Public/tab-3.png">
            </a>
            <a class="tab" href="http://wx.vlegend.cn/rule.html">
                <img src="http://wx.vlegend.cn/Public/tab-4.png">
            </a>
        </div>
        <ul class="list">
            <volist name="gift" id="vo">
                <li>
                    <div class="pic">
                            <img src="{$Think.config.SRC}/{$vo.pic}">
                    </div>
                    <div class="score left">
                        <p class="t1">{$vo.name}</p>
                        <p>
                            <span class="credit">积分:{$vo.credit}</span>
                               
                        </p>
                        <p>
                                <span class="count">数量:{$vo.count}</span> 
                            
                        </p>
                    </div>
                    <div class="exchange left">
                                <a class="btn btn-success btn-click" data-score="{$vo.credit}" data-id="{$vo.id}" data-type="{$vo.type}" data-count="3" href="javascript:">兑换</a>
                    </div>                
                </li>
            </volist>
        </ul>
    </div>




    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
       aria-labelledby="myModalLabel" aria-hidden="true">
       <div class="modal-dialog">
          <div class="modal-content">
             <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" 
                   aria-hidden="true">×
                </button>
                <h4 class="modal-title text-center" id="myModalLabel">
                   积分兑换
                </h4>
             </div>
             <div class="modal-body">
                <form id="form" class="form-horizontal" method="post" action="exchange">
                    <div id="userGroup" class="form-group">
                        <label id="forUser" for="username" class="col-xs-3 control-label">姓名</label>
                        <div class="col-xs-9">
                          <input type="text" name="username" class="form-control" id="username" placeholder="收货人">
                        </div>
                    </div> 
                    <div id="addrGroup" class="form-group">
                        <label for="addr" class="col-xs-3 control-label">地&nbsp;&nbsp;&nbsp;址</label>
                        <div class="col-xs-9">
                          <input type="text" name="addr" class="form-control" id="addr" placeholder="收货地址">
                        </div>
                    </div> 
                    <div class="form-group">
                        <label for="phone" class="col-xs-3 control-label">手&nbsp;&nbsp;&nbsp;机</label>
                        <div class="col-xs-9">
                          <input type="text" name="phone" class="form-control" id="phone" placeholder="您的手机">
                        </div>
                    </div> 
                    <div class="form-group">
                        <label id="mNeed" class="control-label left pl10" >需要:</label>
                        <label id="mOwn" class="control-label right pr10" >拥有:</label>
                    </div>
                    <div class="form-group">
                        <label id="error" class="control-label left pl10 red" ></label>
                        
                    </div>
                    <input id="userId" name="userid" type="hidden" value="{$id}" />
                    <input id="userScore" name="score" type="hidden" value="{$user.sum}" />
                    <input id="giftId" name="giftid" type="hidden" value="" />       
                </form> 
             </div>
             <div class="modal-footer">
                <button type="button" class="btn btn-default left" 
                   data-dismiss="modal">取消</button>
                <button id="submit" type="button" class="btn btn-primary">
                   兑换
                </button>
             </div>
          </div><!-- /.modal-content -->
       </div><!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

<!-- system modal start -->
    <div id="alert" class="modal">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
            <h5 class="modal-title h4"><i class="fa fa-exclamation-circle"></i>提示</h5>
          </div>
          <div class="modal-body small">
            <p id="mContent" class="h5">积分不足,赶快去玩游戏赚取积分吧!</p>
          </div>
        </div>
      </div>
    </div>
  <!-- system modal end -->


    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        (function(){
            var V = {};
            V.init = function(){
                var winH = window.innerHeight;
                var winW = document.body.clientWidth||window.innerWidth;
                var colH = parseInt(winH*0.8/4);
                var pW   = parseInt(winW*0.27);
                if(pW >= colH){
                    colH = parseInt(pW*1.1); 
                }            
                var pH   = parseInt(colH*0.40);
                var aH   = parseInt(colH*0.28);
                
                var sW   = parseInt(winW*0.33);
                var wW   = parseInt(winW*0.4*0.3);
                var tH   = (colH - pW)/2;

                // var pt20 = parseInt(colH*0.25);
                var cssNode = document.createTextNode(".list li{height:"+colH+"px;overflow:hidden;} .pic{width:"+pW+"px;padding-top:"+tH+"px;padding-left:"+tH+"px;} .score{width:"+sW+"px;padding-top:"+tH+"px;} .exchange{padding-top:"+pH+"px;padding-left:"+wW+"px;} .menu{width:100%;height:"+colH+"px;} .tab{line-height:"+colH/2+"px;height:"+colH/2+"px;}"); 
                //}
                var style = document.createElement("style"); 
                style.type = "text/css"; 
                style.appendChild(cssNode);
                document.head.appendChild(style);                 
            }
            V.init();
            $(window).resize(function(){
                V.init();
            });   

        })();

       $(function () { 
            $(".btn-click").click(function(i){
                var credit = parseInt($("#userScore").val()) || 0;
                var userId = $("#userId").val();
                var needScore = parseInt($(this).attr("data-score"));
                var gifttype = $(this).attr("data-type");
                var count  = parseInt($(this).attr("data-count"));
                var giftId =$(this).attr("data-id");
                if (gifttype == "hb") {
                    var currTime = new Date();
                    var hour = currTime.getHours();
                    var minute = currTime.getMinutes();
                    if (hour == 14 && minute <= 30) {

                    }else{
                        $("#mContent").html("<p>红包活动还没开始哟！</p><p>只在每天14:00-14:30开启!</p>只有关注了才能领取奖品哟!<img class=\"erwei\" src=\"http://wx.vlegend.cn/Public/ji/guanzhu.png\">");
                        $("#alert").modal('show');
                        return false;                          
                    }

                }
                if (count <= 0) {
                    $("#mContent").text("该奖品已经被抢完，请关注下期活动吧!");
                    $("#alert").modal('show');
                    return false;
                }
                if(needScore > credit){
                    $("#mContent").html("<p>积分不足,赶快去助威赚积分吧!只有关注了才能领取奖品哟!</p><img class=\"erwei\" src=\"http://wx.vlegend.cn/Public/ji/guanzhu.png\">");
                    $("#alert").modal('show');
                    return false;
                }else{
                    $("#giftId").val(giftId);
                    $("#mNeed").text("需要:"+needScore);
                    $("#mOwn").text("拥有:"+credit);
                    if (gifttype == "hb") {
                        $.get("http://wx.vlegend.cn/checkHB",function(data,status){
                            if(data == 0){
                                $("#mContent").text("您已经换过红包了哟!");
                                $("#alert").modal('show');
                            }else{
                                $("#addrGroup").addClass("hide");
                                $("#forUser").text("支付宝");
                                $("#myModal").modal('show');                                
                            }
                        });

                    }else{
                        $("#myModal").modal('show');
                    }
                    
                }
            });

            $("#submit").click(function(event){
                event.preventDefault();
                var phone = $("#phone").val();
                var addr  = $("#addr").val();
                var userName  = $("#username").val();
                if(!phone){
                    $("#error").text("请填写手机号");
                }
                if(!addr){
                    $("#error").text("请填写地址");
                }
                if(!userName){
                    $("#error").text("请填写收货人姓名");
                }
                if(!!phone && !!userName){
                    $("#form").submit();
                }                
                             
            });
       //  $('#myModal').modal({
       //    keyboard: true
       //  }
       // )
            //$('#identifier').modal('show')
        });
    </script>
</body>
</html>